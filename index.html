<!doctype html><meta name=viewport content="width=1400,user-scalable=no,initial-scale:1"><meta name=apple-mobile-web-app-capable content=yes><meta name=mobile-web-app-capable content=yes><meta name=monetization content=$pay.stronghold.co/1a1fbf27169a5334158b2c531b946427ceb><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>😈</text></svg>"><style>#v,body{overflow:hidden;perspective:800px}#dialog,#dialog2{text-shadow:0 0 10px #000}#dialog2,h1{text-align:center}#s,h1{width:100%;height:100%}#angel,#devil,#head,#hero{position:absolute;width:99px;height:99px}#woop,h1{opacity:0}#devil,#dialog,#head,#hero,canvas,h1{top:0;left:0}#v.title h1,h1{text-shadow:0 0 30px #fff,0 0 10px #fff}#v.title h1,#v.title h2{display:block;opacity:1;position:static;height:auto;background:0 0}#dialog,#dialog3,#timerdiv,#v.title,h1{color:#fff}@keyframes fire{50%{background-position:0 -150px}}@keyframes wooop{0%,100%{transform:scale(.01)}50%{transform:scale(3)}}*{user-select:none}body{background:#111}#v{width:800px;height:600px;margin:auto;position:relative;transform-style:preserve-3d;transition:transform .4s,background 1s}#head{background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 99A20 19 0 0 1 30 80L20 40L13 34L23 38L20 31L27 36L28 28L31 36L33 25L36 34L40 27L42 34L47 25L47 33L56 23L52 33L61 28L56 37L68 30L62 38L55 80A23 19 0 0 1 80 99Z' fill='%23000000'/%3E%3C/svg%3E");transform:translateX(200px) translateY(700px) scale(4) rotate(45deg);transition:.5s}#dialog{position:absolute;font:40px calibri,arial;width:350px;transform:translateX(350px) translateY(450px)}#dialog2{position:absolute;top:30px;left:-50px;color:red;font:bold 35px calibri,arial;width:400px}#devil{background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 99Q4 64 30 60Q18 50 25 35Q14 26 27 15Q21 25 31 32Q39 25 50 32Q58 22 50 16Q65 18 56 35Q64 51 50 61Q81 61 91 99Z' fill='%23ff0000'/%3E%3C/svg%3E");opacity:.01}#angel{left:0;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 99Q24 93 35 69Q27 70 29 65Q21 63 24 59Q15 58 19 54Q8 55 11 50Q2 47 6 42Q0 35 6 32Q15 45 31 46A10 12 0 0 1 60 46Q79 48 89 31Q97 28 95 35Q96 42 91 40Q94 49 90 47Q91 56 84 55Q82 63 77 61Q74 69 69 66Q70 71 63 70Q70 96 87 99Z' fill='%23ffffff'/%3E%3Cpath d='M28 24A18 7 0 1 1 28 25ZM31 25A15 5 0 1 0 31 24Z' fill='%23ffffff'/%3E%3C/svg%3E");opacity:.05;transform:scale(6);top:200px}h1{position:absolute;font:30px arial;margin:0;padding:250px 0 0;background:#000}#light{background:#fff}#hero{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 15L6 11L9 13L8 10L11 13L12 9L13 13L15 9L15 13L17 10L17 13L19 10L18 15L17 25A4 4 0 0 1 22 30L17 32L17 44A2 2 0 0 1 8 44L8 32L3 28A7 9 0 0 1 9 25Z' fill='%23000000'/%3E%3Cpath d='M22 29L22 46A1 1 0 0 1 17 46L17 25Z' fill='%23000000'/%3E%3Cpath d='M3 28L3 47A1 1 0 1 0 8 47L8 25Z' fill='%23000000'/%3E%3Cpath d='M12 45L12 71A2 1 0 1 0 17 71L17 43Z' fill='%23000000'/%3E%3Cpath d='M9 44L9 70A2 2 0 1 0 14 70L14 45Z' fill='%23000000'/%3E%3C/svg%3E");display:none}#woop{width:200px;height:200px;background:radial-gradient(#000,#0000 50%);position:absolute;left:340px;top:380px}#exit,#start,.outro #exit,.outro #start{height:150px;border-radius:50%;opacity:.5;transition:.5s;position:absolute;width:150px}canvas{position:absolute;box-shadow:0 0 0 500px #000}#start,.outro #exit{background:radial-gradient(#aaf,#0000 75%);transform-origin:center center;transform:scale(1)}#exit,.outro #start{background:radial-gradient(#000,#0000 75%);transform-origin:center center;transform:scale(.2)}#dpad div,#toggle_sound{width:50px;text-align:center}#dpad,#reset,#toggle_sound{position:fixed}#v.title{background:linear-gradient(#300,#a00);background-size:200% 200%;animation:2s infinite fire;text-align:center;font-family:Arial,sans-serif}#v.title h1{font-size:100px;padding:50px 0 0}#dialog3,#v.title h2{text-shadow:0 0 10px #000}#v.title h2{font-size:40px;padding:0;cursor:pointer}#v.title h2 div{font-size:20px}#dialog3{position:absolute;top:20px;left:calc(50% - 350px);font:30px/1.1 calibri,arial;width:700px}#timerdiv{position:absolute;top:10px;left:calc(50% - 380px);font:50px calibri,arial;text-shadow:0 0 3px #fff}#dpad #grab,#dpad #jump,#toggle_sound{display:block;font-family:calibri}#dpad{width:100%;top:430px;left:10px;z-index:2}#dpad div{display:inline-block;font-size:35px;pointer-events:all;margin:10px;height:50px;border-radius:5px;background:linear-gradient(45deg,#ddd,#888);box-shadow:2px 2px 5px #000;font-weight:700;padding:4px 0 0;vertical-align:bottom}#dpad div[hidden]{visibility:hidden;cursor:pointer}#reset{top:10px;left:10px}#dpad #grab{position:absolute;right:50px;bottom:0;width:150px}#dpad #jump{position:absolute;right:50px;bottom:100px;width:150px}#toggle_sound{left:calc(50% + 420px);top:10px;background:#333;padding:10px;font-size:20px}</style><title>PUZZLATORY</title><body id=b><script>onload=()=>{current_screen=0,location.hash.length>1?draw_screen(2):current_level=+localStorage.puzzlatory_continue||0},draw_screen=e=>{current_screen=e,audio=1,0==e?b.innerHTML='<div id=v class=title><div id=devil style="transform:scale(8);left:420px;top:380px;opacity:.1;pointer-events:none"></div><h1>PUZZLATORY</h1><br><br><br><br><br><br><h2 onclick="draw_screen(1);current_level=0;play_music(0)">Start</h2><h2 onclick="draw_screen(2);audio=1;play_music(1)">Continue</h2><h2 onclick="location=\'//xem.github.io/js13k22/src/bonus.html\'">Bonus</h2>':1==e?(audio=1,b.innerHTML="<div id=v><h1 id=light></h1><div id=s><div id=devil></div>\n<div id=head></div><div id=hero></div><div id=dialog></div><div id=dialog2></div><div id=woop></div></div><h1 id=caption>JS13kGames<br>presents...</h1></div><div id=toggle_sound onclick=\"audio=1-audio;this.innerHTML=['🔇','🔊'][audio]\" oncontextmenu=\"return false\">🔊</div>",intro()):2==e&&(b.innerHTML='<div id=v><h1 id=light></h1><div id=devil></div><div id=angel style="left:-1000px"></div><canvas id=canvas width=800 height=600></canvas><div id=start style="opacity:0"></div><div id=exit></div></div><div id=dialog3></div><div id=timerdiv onclick=restart()></div><div id=dpad style=display:none><div hidden>↑</div><div hidden>↓</div><br><div ontouchstart=l=1 ontouchend=l=0 oncontextmenu="return false">◀︎</div><div ontouchstart=d=1 ontouchend=d=0 oncontextmenu="return false" hidden>▼</div><div ontouchstart=r=1 ontouchend=r=0 oncontextmenu="return false">▶︎</div><div id=reset ontouchstart=R=1 ontouchend=R=0 oncontextmenu="return false">↺</div><div id=jump ontouchstart=u=1 ontouchend=u=0 oncontextmenu="return false">JUMP</div><div id=grab ontouchstart=s=1 ontouchend=s=0 oncontextmenu="return false">GRAB</div></div><div id=toggle_sound onclick="audio=1-audio;this.innerHTML=[\'🔇\',\'🔊\'][audio]" oncontextmenu="return false">🔊</div>',location.hash.length>2?(current_level=99,play(location.hash.slice(1))):play(...levels[current_level]))},draw_screen(0),mobile=navigator.userAgent.match("Mobi"),mobile&&(dpad.style.display="block",b.style.minWidth="1400px"),oncontextmenu=e=>{e.preventDefault()},u=r=d=l=s=R=0,onkeydown=onkeyup=e=>{this["s****lurd************************l**r************lRd***u**u"[e.which-32]]=e.type[5]},A=new(self.AudioContext||self.webkitAudioContext),m=A.createBuffer(1,1e6,44100),music=[[1,1,1,1,1,89,89,88,88,,,89,89,88,88,,,89,89,88,89,,91,,89,88,,,,89,89,88,88,,,89,89,88,88,,,89,89,88,89,,91,,89,88,,,,93,93,91,91,,,93,93,91,91,,,93,93,91,89,,91,,89,91,,,,93,93,91,91,,,93,93,91,91,,,93,93,91,93,94,93,91,89,91,89,88,86,,,,,,,,,,],[1,1,1,1,59,,,64,67,,71,76,,71,67,,64,59,,64,67,,71,76,,,59,,,,62,66,,71,74,,71,66,,62,59,,62,66,,71,74,,,,,75,74,,73,62,,74,74,,,75,74,73,,62,,63,62,,61,,63,62,,61,60,,67,66,,]],piano=(e,t,r)=>{var l,o,i,s,a,n;for(l=[2,1.5][current_song],1,[],c=0,o=(e,t,r,l)=>Math.sin(e/t*6.28*r+l),i=(e,t)=>Math.sin(e/44100*t*6.28+o(e,44100,t,0)**2+.75*o(e,44100,t,.25)+.1*o(e,44100,t,.5)),a=[],s=0;s<44100*l;s++)a[s]=(s<120?s/120.2*i(s,e):(1-(s-88.2)/(44100*(l-.002)))**((.5*Math.log(1e4*e/44100))**2)*i(s,e)/1)/5;m.getChannelData(0).set(t?a.reverse():a),(n=A.createBufferSource()).buffer=m,n.connect(A.destination),n.start()},current_song=0,current_note=0,music_interval=0,play_music=e=>{current_song=e,clearInterval(music_interval),current_note=0,music_interval=setInterval(play_note,[400,250][e])},play_note=()=>{audio&&(hero.mirror_v?(current_note--,current_note<0&&(current_note=music[current_song].length-1)):(current_note++,1==current_song&&(current_note%=music[current_song].length-1)),1==music[current_song][current_note]?piano(1e-4):music[current_song][current_note]&&piano(440*1.06**(music[current_song][current_note]-80),hero.inverted))},win_sound=function(e,t){if(e>1e4)return null;t(e,1e4);return Math.sin(.01*e*Math.sin(.4*e)+Math.sin(e/100))/3},gravity_sound=function(e,t){var r=13e3;if((e*=.75)>r)return null;var l=Math.pow(t(e,r),3.1);return Math.pow(e,1.08)&(e<4333.333333333333?98:99)?l:-l},time_sound=function(e,t){if(e>2e4)return null;var r=t(e,2e4);return e*=.1,Math.sin(.03*Math.pow(e,.9)*Math.sin(.09*Math.pow(e,1.1)+Math.sin(e/200))+Math.sin(e/100))*r*r};var e=e=>{var t,r,l,o,s;for(t=(e,t)=>(t-e)/t,o=(l=(r=new AudioContext).createBuffer(1,96e3,48e3)).getChannelData(0),i=96e3;i--;)o[i]=e(i,t);(s=r.createBufferSource()).buffer=l,s.connect(r.destination),s.start()};intro=()=>{v.style.background="linear-gradient(#000,#700)",v.style.backgroundSize="200% 200%",v.style.animation="fire infinite 2s",devil.style.transform="translateX(500px) translateY(-220px) scale(17)",setTimeout((()=>head.style.transform="translateX(200px) translateY(355px) scale(4)"),1e3),setTimeout((()=>devil.style.transition="all 5s"),1e3),setTimeout((()=>dialog.innerHTML="WH... WHERE AM I?"),2e3),setTimeout((()=>dialog.style.left="-50px"),5e3),setTimeout((()=>dialog.innerHTML=""),5e3),setTimeout((()=>dialog.style.fontSize="30px"),5e3),setTimeout((()=>head.style.transition="all 5s"),5e3),setTimeout((()=>head.style.transform="translateX(150px) translateY(455px) scale(2)"),5e3),setTimeout((()=>devil.style.opacity=".05"),5e3),setTimeout((()=>devil.style.transform="translateX(500px) translateY(220px) scale(7)"),5e3),setTimeout((()=>dialog2.innerHTML="IN A PLACE<br>BEYOND SPACE<br>AND TIME..."),9e3),setTimeout((()=>devil.style.transition="all 16s"),9e3),setTimeout((()=>head.style.transition="all 16s"),9e3),setTimeout((()=>devil.style.transform="translateX(450px) translateY(220px) scale(7)"),9e3),setTimeout((()=>head.style.transform="translateX(180px) translateY(455px) scale(2)"),9e3),setTimeout((()=>dialog2.innerHTML=""),12e3),setTimeout((()=>dialog.innerHTML="OH MY GOD...<br>AM I DEAD?"),14e3),setTimeout((()=>dialog.innerHTML=""),17e3),setTimeout((()=>dialog2.innerHTML="WORSE !<br>YOU ARE..."),18e3),setTimeout((()=>dialog2.innerHTML=""),2e4),setTimeout((()=>dialog2.innerHTML="<br><br><br>IN A<br>PUZZLE<br>GAME!"),21e3),setTimeout((()=>devil.style.transition="all .5s"),21e3),setTimeout((()=>head.style.transition="all .5s"),21e3),setTimeout((()=>devil.style.transform="translateX(540px) translateY(365px) scale(12)"),21e3),setTimeout((()=>head.style.transform="translateX(85px) translateY(574px) scale(5)"),21e3),setTimeout((()=>dialog2.innerHTML=""),23e3),setTimeout((()=>light.style.opacity=1),22500),setTimeout((()=>light.style.opacity=0),22570),setTimeout((()=>light.style.opacity=.7),22800),setTimeout((()=>light.style.opacity=0),22980),setTimeout((()=>caption.style.opacity=1),23500),setTimeout((()=>intro2()),28e3)},intro2=()=>{v.style.animation="none",hero.style.display="block",head.style.display="none",devil.style.transition="none",caption.style.opacity=0,v.style.background="linear-gradient(#0000 90%, #000 90%), radial-gradient(at top left, #6bf 25%,#744 45%, #600 65%, #000)",devil.style.transform="translateX(660px) translateY(340px) scale(3)",devil.style.opacity=".2",dialog2.style.left="430px",hero.style.transform="translateX(415px) translateY(446px) scale(2)",setTimeout((()=>hero.style.transition="all 8s"),500),setTimeout((()=>devil.style.transition="all 8s"),500),setTimeout((()=>hero.style.transform="translateX(465px) translateY(446px) scale(2)"),500),setTimeout((()=>devil.style.transform="translateX(610px) translateY(340px) scale(3)"),500),setTimeout((()=>dialog2.innerHTML="THIS PLACE<br>IS BETWEEN<br>HEAVEN & HELL<br>..."),500),setTimeout((()=>dialog2.innerHTML=""),4e3),setTimeout((()=>dialog2.innerHTML="TO CHOOSE YOUR<br>PATH, YOU WILL<br> HAVE TO SOLVE<br>MY PUZZLES!"),4500),setTimeout((()=>dialog2.innerHTML=""),8500),setTimeout((()=>woop.style.opacity=1),8500),setTimeout((()=>woop.style.animation="wooop 1s forwards"),8500),setTimeout((()=>hero.style.transition="none"),8500),setTimeout((()=>hero.style.opacity="0"),9e3),setTimeout((()=>dialog2.innerHTML="<br><br>HE HE HE..."),9e3),setTimeout((()=>dialog2.innerHTML=""),11e3),setTimeout((()=>caption.style.font="100px arial"),11500),setTimeout((()=>caption.innerHTML="PUZZLATORY"),11500),setTimeout((()=>caption.style.opacity=1),11500),setTimeout((()=>{audio=0,draw_screen(2),play_music(1),localStorage.puzzlatory_continue=0}),13500)},s_release=1,lightning=()=>{light.style.opacity=.8,setTimeout((()=>light.style.opacity=0),200),setTimeout((()=>light.style.opacity=.8),300),setTimeout((()=>light.style.opacity=0),350)},draw_hero=(e,t,r,l,o,i,s,a=1,n=0)=>{ctx.save(),s&&(ctx.fillStyle="#ddd"),i?(o?(ctx.translate(e,t),ctx.rotate(Math.PI),ctx.translate(-17,-62),ctx.scale(1.5,1.5)):(ctx.translate(e,t),ctx.rotate(Math.PI),ctx.translate(20,-62),ctx.scale(-1.5,1.5)),a&&("hold"==r?o?(tl=[hero.x+-10,hero.y-45],tr=[hero.x+10,hero.y-45],bl=[hero.x+-45,hero.y+45],br=[hero.x+10,hero.y+45],ml=[hero.x+-45,hero.y],mr=[hero.x+10,hero.y]):(tl=[hero.x+-10,hero.y-45],tr=[hero.x+10,hero.y-45],bl=[hero.x+-10,hero.y+45],br=[hero.x+45,hero.y+45],ml=[hero.x+-10,hero.y],mr=[hero.x+45,hero.y]):(tl=[hero.x+-10,hero.y-35],tr=[hero.x+10,hero.y-35],bl=[hero.x+-10,hero.y+45],br=[hero.x+10,hero.y+45],ml=[hero.x+-10,hero.y],mr=[hero.x+10,hero.y]))):(o?(ctx.translate(e+20,t-55),ctx.scale(-1.5,1.5)):(ctx.translate(e-17,t-55),ctx.scale(1.5,1.5)),a&&("hold"==r?o?(tl=[hero.x+-45,hero.y-45],tr=[hero.x+10,hero.y-45],bl=[hero.x+-10,hero.y+45],br=[hero.x+10,hero.y+45],ml=[hero.x+-45,hero.y],mr=[hero.x+10,hero.y]):(tl=[hero.x+-10,hero.y-45],tr=[hero.x+45,hero.y-45],bl=[hero.x+-10,hero.y+45],br=[hero.x+10,hero.y+45],ml=[hero.x+-10,hero.y],mr=[hero.x+45,hero.y]):(tl=[hero.x+-10,hero.y-35],tr=[hero.x+10,hero.y-35],bl=[hero.x+-10,hero.y+45],br=[hero.x+10,hero.y+45],ml=[hero.x+-10,hero.y],mr=[hero.x+10,hero.y]))),n&&"hold"==r?ctx.fill(new Path2D("M3 28L7 41L23 41A3 3 0 0 0 23 34L11 34L9 26Z")):(ctx.fill(new Path2D("M17 15L20 20L16 21ZM8 15L6 11L9 13L8 10L11 13L12 9L13 13L15 9L15 13L17 10L17 13L19 10L18 15L17 25A4 4 0 0 1 22 30L17 32L17 44A2 2 0 0 1 8 44L8 32L3 28A7 9 0 0 1 9 25Z")),"idle"==r||"walk1"==r?(ctx.fill(new Path2D("M3 28L3 47A1 1 0 1 0 8 47L8 25Z")),ctx.fill(new Path2D("M22 29L22 46A1 1 0 0 1 17 46L17 25Z"))):"hold"==r?(ctx.fill(new Path2D("M3 28L7 41L23 41A3 3 0 0 0 23 34L11 34L9 26Z")),ctx.fill(new Path2D("M15 26L19 38L32 38A2 2 0 0 0 32 32L24 32L20 26Z"))):"walk0"==r||"jump"==r?(ctx.fill(new Path2D("M16 27L18 46A1 1 0 0 0 24 44L21 26Z")),ctx.fill(new Path2D("M4 28L1 47A1 1 0 0 0 6 48L10 26Z"))):"walk2"==r&&(ctx.fill(new Path2D("M4 28L6 49A2 2 0 0 0 12 48L9 26Z")),ctx.fill(new Path2D("M16 26L14 45A1 1 0 0 0 18 47L21 28Z"))),"idle"==l?(ctx.fill(new Path2D("M12 45L12 71A2 1 0 1 0 17 71L17 43Z")),ctx.fill(new Path2D("M9 44L9 70A2 2 0 1 0 14 70L14 45Z"))):"walk2"==l?(ctx.fill(new Path2D("M9 46L13 71A4 3 0 0 0 20 69L14 46Z")),ctx.fill(new Path2D("M11 45L6 68A2 2 0 0 0 11 70L16 46Z"))):"walk0"==l?(ctx.fill(new Path2D("M9 46L10 69A3 5 0 0 0 15 69L14 46Z")),ctx.fill(new Path2D("M12 47L14 56L6 64A1 1 0 0 0 10 68L21 57L15 46Z"))):"jump"!=l&&"walk1"!=l||(ctx.fill(new Path2D("M9 46L11 58L8 68A2 2 0 0 0 12 70L16 58L13 46Z")),ctx.fill(new Path2D("M12 47L18 56L17 67A2 2 0 0 0 22 68L23 56L17 46Z"))),a==current_self&&current_self>1&&(ctx.beginPath(),ctx.moveTo(5*o+10,0),ctx.lineTo(5*o+0,-10),ctx.lineTo(5*o+20,-10),ctx.closePath(),ctx.fillStyle="#269",ctx.fill())),ctx.restore()},hit=(e,t,r,l)=>{for(i in hitx=50*(e/50|0)+25,hity=50*(t/50|0)+25,cubes)if(hero.hold!=+i&&!cubes[i].holding&&cubes[i].x-25<e&&cubes[i].x+25>e&&cubes[i].y-25<t&&cubes[i].y+25>t)return hitx=cubes[i].x,hity=cubes[i].y,2;return map[16*(t/50|0)+(e/50|0)]?(hitx=50*(e/50|0)+25,hity=50*(t/50|0)+25,map[16*(t/50|0)+(e/50|0)]):e>950||e<-50?1:0},draw=()=>{var t,r,l;if(!(pause&&(pause--,pause<18&&pause>5)))if(pause2)pause2--;else{if(time++,hero.inverted?present--:present++,present_abs=Math.abs(present),time_array=present<0?past:future,time_array[present_abs]||(time_array[present_abs]={hero:[],cubes:[]}),time_array[present_abs].hero[current_self]=JSON.parse(JSON.stringify(hero)),time_array[present_abs].cubes.length)for(t in time_array[present_abs].cubes)cubes[t].holding!=current_self&&cubes[t].last_grab!=current_self&&(cubes[t].last_grab&&cubes[t].last_grab<current_self?cubes[t]=JSON.parse(JSON.stringify(time_array[present_abs].cubes[t])):(cubes[t]=JSON.parse(JSON.stringify(time_array[present_abs].cubes[t])),cubes[t].holding=0));for(time_array[present_abs].cubes=JSON.parse(JSON.stringify(cubes)),cubes=time_array[present_abs].cubes,canvas.width^=0,x=0;x<16;x++)for(y=0;y<12;y++)1==map[16*y+x]&&ctx.fillRect(50*x,50*y,50,50);for(t in 13!=current_level&&14!=current_level||(ctx.save(),ctx.scale(2,2),ctx.translate(300,180),ctx.fill(new Path2D("M10 99L10 25Q41 0 75 25L75 99Z")),ctx.restore(),ctx.font="40px Times New Roman",ctx.fillStyle="red",ctx.fillText("HELL",635,470),13!=current_level||outro?(14==current_level||outro)&&ctx.fillText("  NO.",635,510):(ctx.fillText("🔥",635+5*Math.random(),550),ctx.fillText("🔥",655+5*Math.random(),550),ctx.fillText("🔥",675+5*Math.random(),550)),ctx.fillStyle="#000"),28==current_level&&(ctx.save(),ctx.scale(2,2),ctx.translate(-5,50),ctx.fillStyle="#def",ctx.fill(new Path2D("M10 99L10 25Q41 0 75 25L75 99Z")),ctx.restore(),ctx.font="30px Times New Roman",ctx.fillStyle="#00f",ctx.fillText("HEAVEN",12,180),28==current_level&&(ctx.font="50px Times New Roman",ctx.fillText("👼",35,250)),ctx.fillStyle="#000"),gravity_inverters)ctx.save(),ctx.beginPath(),gravity_inverters[t].active&&(ctx.fillStyle="#fc0",ctx.strokeStyle="#fc0"),ctx.lineWidth=3,ctx.setLineDash([5,3]),ctx.arc(gravity_inverters[t].x,gravity_inverters[t].y,22,0,7),ctx.stroke(),ctx.translate(gravity_inverters[t].x-50,gravity_inverters[t].y-50),ctx.scale(.9,.9),ctx.translate(5,5),ctx.fill(new Path2D("M53 60L53 40L57 40L50 30L43 40L47 40L47 60L42 60L50 70L58 60Z")),ctx.restore();for(t in cube_slots)cube_slots[t].inverted?(ctx.save(),cube_slots[t].active?(ctx.fillStyle="#fc0",ctx.strokeStyle="#fc0"):(ctx.fillStyle="#bbb",ctx.strokeStyle="#bbb"),ctx.translate(cube_slots[t].x-25,cube_slots[t].y-25),ctx.beginPath(),ctx.lineWidth=3,ctx.setLineDash([6,5]),ctx.rect(0,0,50,50),ctx.stroke(),ctx.fill(new Path2D("M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.restore()):(ctx.save(),cube_slots[t].active?(ctx.fillStyle="#fc0",ctx.strokeStyle="#fc0"):(ctx.fillStyle="#000",ctx.strokeStyle="#000"),ctx.translate(cube_slots[t].x-25,cube_slots[t].y-25),ctx.beginPath(),ctx.lineWidth=4,ctx.setLineDash([6,5]),ctx.rect(0,0,50,50),ctx.stroke(),ctx.translate(0,0),ctx.fill(new Path2D("M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.restore());for(t in time_inverters)ctx.save(),time_inverters[t].active?(ctx.fillStyle="#fc0",ctx.strokeStyle="#fc0"):(ctx.fillStyle="hsl(0deg 0% "+(30*Math.cos(time/15)+30)+"%)",ctx.strokeStyle="hsl(0deg 0% "+(30*Math.cos(time/15)+30)+"%)"),ctx.beginPath(),ctx.lineWidth=3,ctx.setLineDash([5,5]),ctx.translate(time_inverters[t].x,time_inverters[t].y),ctx.arc(0,0,22,0,7),ctx.stroke(),ctx.translate(-30,-30),ctx.scale(.7,.7),ctx.translate(-7,-7),ctx.fill(new Path2D("M45 40L55 51L55 42A4 4 0 0 1 60 57L60 61A6 6 0 0 0 55 37L55 30ZM55 61L45 50L45 57A2 2 0 1 1 40 44L40 39A8 8 0 0 0 45 62L45 70Z")),ctx.restore();for(t in cubes)cubes[t].holding||(ctx.save(),cubes[t].inverted?ctx.fillStyle="#ddd":ctx.fillStyle="#000",ctx.translate(cubes[t].x,cubes[t].y),cubes[t].mirror_v&&(ctx.rotate(Math.PI),ctx.translate(0,-.5)),ctx.translate(-25,-25),ctx.fill(new Path2D("M9 0.5L40 0.5A10 9 0 0 1 50 9L50 40A10 10 0 0 1 40 50L9 50A9 10 0 0 1 1 40L0 9A9 9 0 0 1 9 0M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#7008",ctx.fill(new Path2D("M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#000",ctx.restore());for(t in time_array[present_abs]?.hero)if(t!=current_self){if(!(r=time_array[present_abs].hero[t]))continue;if(draw_hero(r.x,r.y,r.hold?"hold":r.grounded?r.walking?"walk"+~~(r.walk/5)%3:"idle":"jump",r.grounded?r.walking?"walk"+~~(r.walk/4)%3:"idle":"jump",r.mirror_h,r.mirror_v,r.inverted,r),r.stand_on_cube){for(l in paradox[t]++,cubes)cubes[l].x-25>r.x-57&&cubes[l].x+25<r.x+57&&Math.abs(cubes[l].y-r.y)<80&&(paradox[t]=0);paradox[t]>2&&!pause2&&(pause2=150,ctx.save(),hero.mirror_v&&(v.style.transform=""),ctx.beginPath(),ctx.fillStyle="#fff",ctx.lineWidth=10,ctx.strokeStyle="#269",ctx.rect(r.x-30,r.y-60,60,130),ctx.stroke(),ctx.font="130px Arial",ctx.fillText("PARADOX",100,300),ctx.font="30px Arial",ctx.fillText("This guy walks on a cube that has ben removed",100,350),ctx.fillStyle="#000",ctx.lineWidth=3,ctx.strokeStyle="#000",ctx.closePath(),ctx.restore(),setTimeout((()=>{ctx.fillRect(0,0,800,600)}),4500),setTimeout(restart,5e3))}r.hold&&(ctx.save(),cubes[r.hold].inverted?ctx.fillStyle="#ddd":ctx.fillStyle="#000",ctx.translate(cubes[r.hold].x,cubes[r.hold].y),cubes[r.hold].mirror_v&&(ctx.rotate(Math.PI),ctx.translate(0,-.5)),ctx.translate(-25,-25),ctx.fill(new Path2D("M9 0.5L40 0.5A10 9 0 0 1 50 9L50 40A10 10 0 0 1 40 50L9 50A9 10 0 0 1 1 40L0 9A9 9 0 0 1 9 0M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#7008",ctx.fill(new Path2D("M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#000",ctx.restore(),r=time_array[present_abs].hero[t],draw_hero(r.x,r.y,r.hold?"hold":r.grounded?r.walking?"walk"+~~(r.walk/5)%3:"idle":"jump",r.grounded?r.walking?"walk"+~~(r.walk/4)%3:"idle":"jump",r.mirror_h,r.mirror_v,r.inverted,r,!0))}for(t in draw_hero(hero.x,hero.y,hero.hold?"hold":hero.grounded?hero.walking?"walk"+~~(hero.walk/5)%3:"idle":"jump",hero.grounded?hero.walking?"walk"+~~(hero.walk/4)%3:"idle":"jump",hero.mirror_h,hero.mirror_v,hero.inverted,current_self),hero.hold&&(ctx.save(),cubes[hero.hold].inverted?ctx.fillStyle="#ddd":ctx.fillStyle="#000",ctx.translate(cubes[hero.hold].x,cubes[hero.hold].y),cubes[hero.hold].mirror_v&&(ctx.rotate(Math.PI),ctx.translate(0,-.5)),ctx.translate(-25,-25),ctx.fill(new Path2D("M9 0.5L40 0.5A10 9 0 0 1 50 9L50 40A10 10 0 0 1 40 50L9 50A9 10 0 0 1 1 40L0 9A9 9 0 0 1 9 0M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#7008",ctx.fill(new Path2D("M35 20A3 3 0 0 0 25 20A5 5 0 0 0 15 20Q15 25 25 35Q35 25 35 20")),ctx.fillStyle="#000",ctx.restore(),draw_hero(hero.x,hero.y,hero.hold?"hold":hero.grounded?hero.walking?"walk"+~~(hero.walk/5)%3:"idle":"jump",hero.grounded?hero.walking?"walk"+~~(hero.walk/4)%3:"idle":"jump",hero.mirror_h,hero.mirror_v,hero.inverted,current_self,!0)),hero.mirror_v?hero_physics_v():hero_physics(),(hero.y>700||hero.y<-100)&&(pause2=1/0,ctx.save(),hero.mirror_v&&(v.style.transform=""),restart()),win=0,exit_open>10&&Math.hypot(hero.x-exit_x,hero.y-exit_y)<50&&(win=1),cubes)cubes[t].mirror_v?cubes[t].holding||((0==hit(cubes[t].x-20,cubes[t].y-26)||hit(cubes[t].x+-20,cubes[t].y-26)>2)&&(0==hit(cubes[t].x+22,cubes[t].y-26)||hit(cubes[t].x+22,cubes[t].y-26)>2)?(cubes[t].vy+=gravity,cubes[t].vy=Math.min(cubes[t].vy,15),cubes[t].y-=cubes[t].vy):(cubes[t].y=50*~~(cubes[t].y/50)+25,cubes[t].vy=0)):cubes[t].holding||((0==hit(cubes[t].x-20,cubes[t].y+26)||hit(cubes[t].x+-20,cubes[t].y+26)>2)&&(0==hit(cubes[t].x+22,cubes[t].y+26)||hit(cubes[t].x+22,cubes[t].y+26)>2)?(cubes[t].vy+=gravity,cubes[t].vy=Math.min(cubes[t].vy,15),cubes[t].y+=cubes[t].vy):(cubes[t].y=50*~~(cubes[t].y/50)+25,cubes[t].vy=0));if(0==herogravitydelay)for(t in gravity_inverters)gravity_inverters[t].x+25>bl[0]&&gravity_inverters[t].x-25<br[0]&&gravity_inverters[t].y+25>tl[1]&&gravity_inverters[t].y-25<bl[1]?(gravity_inverters[t].active=1,gravity_inversions++,e(gravity_sound),2==current_level&&3==gravity_inversions&&(timeouts.forEach(clearTimeout),timeouts=[],timeouts.push(setTimeout((()=>{dialog3.style.textAlign="right",dialog3.style.fontSize="35px",dialog3.style.color='#fff"',dialog3.innerHTML="<br><br><br><br><br>I THINK I'M GONNA PUKE..."}),1e3)),timeouts.push(setTimeout((()=>{dialog3.innerHTML=""}),5e3))),hero.mirror_v=1-hero.mirror_v,hero.hold&&(cubes[hero.hold].mirror_v=1-cubes[hero.hold].mirror_v,hero.vy=0),herogravitydelay=15,pause=20):gravity_inverters[t].active=0;else herogravitydelay--,13==herogravitydelay&&(v.style.transform="rotateX("+(canvasrx=180-canvasrx)+"deg)");for(r in cubes)if(0!=cubes[r].gravitydelay||cubes[r].holding)cubes[r].gravitydelay&&cubes[r].gravitydelay--;else for(t in gravity_inverters)gravity_inverters[t].x+25>cubes[r].x-25&&gravity_inverters[t].x-25<cubes[r].x+25&&gravity_inverters[t].y+25>cubes[r].y-25&&gravity_inverters[t].y-25<cubes[r].y+25&&(gravity_inverters[t].active=1,cubes[r].mirror_v=1-cubes[r].mirror_v,cubes[r].gravitydelay=1);for(t in time_inverters)!time_inverters[t].active&&time_inverters[t].x+25>bl[0]&&time_inverters[t].x-25<br[0]&&time_inverters[t].y+25>tl[1]&&time_inverters[t].y-30<bl[1]?(time_inverters[t].active=1,lightning(),hero.inverted=1-hero.inverted,e(time_sound),time_travels++,current_self++,hero.hold&&(hero.inverted?(time_array[Math.abs(present+1)]||(time_array[Math.abs(present+1)]=JSON.parse(JSON.stringify(time_array[present_abs]))),time_array[Math.abs(present+1)].cubes[hero.hold].x=9999):time_array[Math.abs(present-1)]||(time_array[Math.abs(present-1)]=JSON.parse(JSON.stringify(time_array[present_abs]))),cubes[cubes.length]=JSON.parse(JSON.stringify(cubes[hero.hold])),hero.hold=cubes.length-1,cubes[hero.hold].holding=current_self,cubes[hero.hold].inverted=1-cubes[hero.hold].inverted)):time_inverters[t].x+25>bl[0]&&time_inverters[t].x-25<br[0]&&time_inverters[t].y+25>tl[1]&&time_inverters[t].y-30<bl[1]||(time_inverters[t].active=0);for(t in(current_level<14||99==current_level)&&exit_open++,cube_slots)cube_slots[t].active=0;for(r in cubes)if(cubes[r].holding)cubes[r].gravitydelay&&cubes[r].gravitydelay--;else for(t in cube_slots)cube_slots[t].inverted==cubes[r].inverted&&cube_slots[t].x+25>cubes[r].x-25&&cube_slots[t].x-25<cubes[r].x+25&&cube_slots[t].y+25>cubes[r].y-25&&cube_slots[t].y-25<cubes[r].y+25&&(cube_slots[t].active=1);for(t in(current_level<14||99==current_level)&&0==cube_slots.length&&(exit_open=0),cube_slots)!cube_slots[t].active&&(current_level<14||99==current_level)&&(exit_open=0);(current_level<14||99==current_level)&&force_exit_open&&(exit_open=99),exit.style.opacity=exit_open>10?1:.5,exit.style.transform=exit_open>10?"scale(1)":"scale(.2)",ctx.fillStyle="#000",win&&(hero.x=hero.x+(exit_x-hero.x)/2,hero.y=hero.y+(exit_y-hero.y)/2),win&&!level_transition&&(e(win_sound),timeouts.forEach(clearTimeout),dialog3.innerHTML="",timeouts=[],pause=50,setTimeout((()=>{clearInterval(interval),start.style.opacity=0,exit.style.opacity=0,canvas.width^=0,ctx.fillRect(0,0,800,600),start.style.display="none",exit.style.display="none"}),300),setTimeout((()=>{28==current_level||99==current_level?(draw_screen(0),audio=0):play(...levels[++current_level]),window.start&&(start.style.display="block"),window.exit&&(exit.style.display="block"),level_transition=0,current_level<99&&(localStorage.puzzlatory_continue=current_level)}),600),level_transition=1),6==current_level&&1==time_travels&&(timeouts.forEach(clearTimeout),timeouts=[],timeouts.push(setTimeout((()=>{dialog3.style.textAlign="left",dialog3.style.fontSize="35px",dialog3.style.color='#fff"',dialog3.innerHTML="<br><br>WOW, THE TIME IS REVERSED?"}),1e3)),timeouts.push(setTimeout((()=>{6==current_level&&(dialog3.style.textAlign="center",dialog3.style.fontSize="40px",dialog3.style.color="#F00",dialog3.innerHTML="YEP. THE WHITE ITEMS<br>MOVE BACKWARDS IN TIME!")}),5e3)),timeouts.push(setTimeout((()=>{6==current_level&&(dialog3.innerHTML="ONLY THE REVERSED CUBES<br>CAN ACTIVATE THE WHITE SLOTS.")}),9e3)),timeouts.push(setTimeout((()=>{6==current_level&&(dialog3.innerHTML="")}),13e3)),time_travels++),current_level>13&&28!=current_level&&99!=current_level?(timer&&(timerdiv.style.top="-20px",timerdiv.style.fontSize="100px",timerdiv.innerHTML=timer/1100|0,timer-=30),timer<0&&(timer=0),0==timer?(exit_open=0,timerdiv.style.top="10px",timerdiv.style.fontSize="50px",timerdiv.innerHTML="RETRY?"):exit_open=99):timerdiv.innerHTML="",28==current_level&&(ctx.fillStyle="#fff",ctx.fillText("THE END.",300,50),ctx.fillText("SPECIAL THANKS:",300,130),ctx.fillText("SALVATORE PREVITI",300,180),ctx.fillText("ADRIEN GUERET",300,230),ctx.fillText("ANDERS KAARE",300,280),ctx.fillText("KANG SEONGHOON",300,330),ctx.fillText("ANDRZEJ MAZUR",300,380),ctx.fillText("AND YOU!",300,430))}},timer=0,play=(e,t=[],r=(()=>{}),l=0,o=2e3)=>{var i;if(l||(dialog3.innerHTML="",timeouts.forEach(clearTimeout),timeouts=[]),v.style.transform="",exit_open=0,map_backup=e,dialogs_backup=t,script_backup=r,(current_level<14||99==current_level)&&(exit_open=0),current_level>13&&99!=current_level?(document.body.classList.add("outro"),timer=11999,exit_open=99):document.body.classList.remove("outro"),14==current_level?start.style.display="none":start.style.display="block",28==current_level&&(exit.style.display="none"),r(),!l&&(current_level<14||99==current_level))for(i in dialogs_backup)timeouts.push(setTimeout("dialog3.style.textAlign='"+(+i%2?"center":"left")+"';dialog3.style.fontSize='"+(+i%2?"40px":"35px")+"';dialog3.style.color='"+(+i%2?"#f00":"#fff")+"';dialog3.innerHTML = `"+(+i%2||13==current_level?"":"<br><br>")+dialogs_backup[i]+"`",4e3*+i+o));for(i in 28==current_level?v.style.background="linear-gradient(rgb(143 119 255), rgb(192 0 0)) 0% 0% / 200% 200%":current_level>13&&99!=current_level?v.style.background="linear-gradient(rgb(56 95 167), rgb(2 8 15)) 0% 0% / 200% 200%":v.style.background="linear-gradient(#300,#a00)",v.style.backgroundSize="200% 200%",v.style.animation="fire infinite 2s",current_level>13&&99!=current_level?(devil.style.display="none",angel.style.display="block",angel.style.opacity=".1",angel.style.left="350px",angel.style.top="200px"):(devil.style.opacity=.05,angel.style.display="none",devil.style.display="block",devil.style.transform="translateX(385px) translateY(225px) scale(7)"),ctx=canvas.getContext("2d"),map=e.split(""),past=[],future=[],present=0,present_abs=0,current_self=1,cubes=[{x:999,y:999,vy:0,grounded:0,holding:0,mirror_v:0,gravitydelay:0,last_grab:0}],gravity_inverters=[],cube_slots=[],time_inverters=[],level_transition=0,time_travels=0,gravity_inversions=0,win=0,(current_level<14||99==current_level)&&(exit_open=0),force_exit_open=0,exit_x=0,exit_y=0,hero={x:0,y:0,vy:0,grounded:0,walk:0,hold:0,mirror_v:0,mirror_h:0,inverted:0},map)2==map[i]&&(cubes.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,vy:0,grounded:0,holding:0,mirror_v:0,inverted:0,gravitydelay:0,last_grab:0}),map[i]=0),3==map[i]&&(gravity_inverters.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,active:0}),map[i]=0),4==map[i]&&(time_inverters.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,active:0}),map[i]=0),5==map[i]&&(cube_slots.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,active:0,inverted:0}),map[i]=0),6==map[i]&&(exit.style.left=50*~~(i%16)+25-75+"px",exit.style.top=50*~~(i/16)+25-75+"px",exit_x=50*~~(i%16)+25,exit_y=50*~~(i/16)+25),7==map[i]&&(cubes.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,vy:0,grounded:0,holding:0,mirror_v:0,inverted:1,gravitydelay:0,last_grab:0}),map[i]=0),8==map[i]&&(cubes.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,vy:0,grounded:0,holding:0,mirror_v:1,inverted:0,gravitydelay:0,last_grab:0}),map[i]=0),9==map[i]&&(cube_slots.push({x:50*~~(i%16)+25,y:50*~~(i/16)+25,active:0,inverted:1}),map[i]=0),"$"==map[i]&&(start.style.left=50*~~(i%16)+25-75+"px",start.style.top=50*~~(i/16)+25-75+"px",start.style.opacity=.5,setTimeout((()=>start.style.transform="scale(.2)"),100),hero.x=50*~~(i%16)+25,hero.y=50*~~(i/16)+25,map[i]=0);paradox=Array(99).fill(0),gravity=2,hold_timer=0,canextendhitbox=1,obstacle1=obstacle2=null,obstacle3=obstacle4=null,herogravitydelay=0,hitx=hity=0,canvasrx=0,pause=0,pause2=0,time=0,tl=tr=bl=br=ml=mr=[],clearInterval(interval),interval=setInterval(draw,30)},restart=()=>{start.style.transform="scale(1)",v.style.transform="",setTimeout((()=>play(map_backup,[],script_backup,1)),250)},outro=0,hero_physics=()=>{var e;if(!outro&&13==current_level&&hero.x>500&&hero.y>300&&(lightning(),pause2=1e3,outro=1,devil.style.transition="all 1s",angel.style.transition="all 1s",angel.style.display="block",devil.style.left="1000px",angel.style.left="350px",angel.style.top="200px",v.style.background="linear-gradient(rgb(56 95 167), rgb(2 8 15)) 0% 0% / 200% 200%",hero.walk=0,timeouts.forEach(clearTimeout),timeouts=[],dialog3.innerHTML="",setTimeout((()=>{dialog3.style.color="#00F",dialog3.style.fontWeight="bold",dialog3.style.fontSize="48px",dialog3.style.textAlign="center",dialog3.style.textShadow="0 0 15px #fff,0 0 10px #fff",dialog3.innerHTML="FEAR NOT, MY CHILD!"}),500),setTimeout((()=>{dialog3.style.color="#00F",dialog3.innerHTML="I AM SALVATORE,<br>THE ANGEL OF SALVATION."}),3500),setTimeout((()=>{dialog3.style.color="#00F",dialog3.innerHTML="I AM HERE TO HELP YOU!"}),7500),setTimeout((()=>{dialog3.style.color="#00F",dialog3.innerHTML="THE HEAVEN'S ENTRANCE IS<br>IN THE INTRO!"}),11500),setTimeout((()=>{dialog3.style.color="#00F",dialog3.innerHTML="YOU NEED TO GO THROUGH<br>ALL THE LEVELS IN REVERSE."}),15500),setTimeout((()=>{dialog3.style.color="#00F",dialog3.innerHTML="I CAN ONLY MAINTAIN THE PORTAL<br>OPEN FOR 10 SECONDS. RUN!"}),15500),setTimeout((()=>{dialog3.style.color="#fff",dialog3.innerHTML="",pause=0}),19500),setTimeout((()=>{play(...levels[current_level=14]),this.blur()}),2e4)),!pause2){if(hero.vy<0&&(1!=hit(tl[0]+5,tl[1])&&1!=hit(tr[0]-5,tr[1])?(hero.grounded=0,hero.vy+=gravity,hero.vy=Math.min(hero.vy,30),hero.y+=hero.vy):(hero.vy=0,hero.y=50*~~(hero.y/50)+(hero.hold?30:10))),hero.stand_on_cube=0,hero.vy>=0&&(obstacle1=hit(bl[0]+5,bl[1]+5),obstacle2=hit(br[0]-5,br[1]+5),obstacle3=hit(ml[0]+5,ml[1]+5),obstacle4=hit(mr[0]-5,mr[1]+5),1==obstacle3||1==obstacle4?(hero.grounded=1,hero.y=hity-30,hero.vy=0):1==obstacle1||1==obstacle2?(hero.grounded=1,hero.y=hity-25,hero.vy=0):2!=obstacle1&&2!=obstacle2||1==hit(tl[0]+5,tl[1]-15)||1==hit(tr[0]+5,tr[1]-15)?(hero.grounded=0,hero.vy+=gravity,hero.vy=Math.min(hero.vy,25),hero.y+=hero.vy):(hero.stand_on_cube=1,hero.grounded=1,hero.vy=0)),hero.walking=0,l&&(hero.x>10&&1!=hit(...tl)&&1!=hit(...ml)&&1!=hit(bl[0],bl[1]-10)&&(hero.x-=5),hero.mirror_h=1,hero.walk++,hero.walking=1),r&&(hero.x<790&&1!=hit(...tr)&&1!=hit(...mr)&&1!=hit(br[0],br[1]-10)&&(hero.x+=5),hero.mirror_h=0,hero.walk++,hero.walking=1),u||(u_release=1),u&&hero.grounded&&u_release&&(hero.vy+=-13,hero.y+=-13,hero.grounded=0,u_release=0,hero.walking=0,hero.stand_on_cube=0),s||(s_release=1),s&&s_release){if(s_release=0,hero.hold)hero.mirror_h?cubes[hero.hold].x-=1==hit(cubes[hero.hold].x-40,cubes[hero.hold].y-25)||1==hit(cubes[hero.hold].x-40,cubes[hero.hold].y+25)?-5:15:cubes[hero.hold].x+=1==hit(cubes[hero.hold].x+40,cubes[hero.hold].y-25)||1==hit(cubes[hero.hold].x+40,cubes[hero.hold].y+25)?-5:15,cubes[hero.hold].holding=0,hero.hold=0;else for(e in cubes)if(!cubes[e].holding&&Math.abs(hero.x-cubes[e].x)<50&&Math.abs(hero.y+30-cubes[e].y)<80&&(Math.abs(hero.y-cubes[e].y)>40||(hero.mirror_h?hero.x>cubes[e].x-25:hero.x<cubes[e].x+25))){hero.y<cubes[e].y-25&&(obstacle1=hit(tl[0]-40,tl[1]),obstacle2=hit(ml[0]-40,ml[1]),1!=obstacle1&&1!=obstacle2||(hero.x=hitx+80),obstacle1=hit(tr[0]+40,tr[1]),obstacle2=hit(mr[0]+40,mr[1]),1!=obstacle1&&1!=obstacle2||(hero.x=hitx-80)),hero.stand_on_cube=0,hero.hold=+e,cubes[e].holding=current_self,cubes[e].last_grab=current_self;break}hold_timer=10}hero.hold&&(time_array[present_abs].cubes[hero.hold].holding=cubes[hero.hold].holding=current_self,time_array[present_abs].cubes[hero.hold].x=cubes[hero.hold].x=hero.x+(canextendhitbox?hero.mirror_h?-25:25:0),time_array[present_abs].cubes[hero.hold].y=cubes[hero.hold].y=hero.y-20)}},hero_physics_v=()=>{var e;if(!pause2){if(hero.vy<0&&(1!=hit(bl[0]+5,bl[1])&&1!=hit(br[0]-5,br[1])?(hero.grounded=0,hero.vy+=gravity,hero.vy=Math.min(hero.vy,30),hero.y-=hero.vy):(hero.vy=0,hero.y=50*~~(hero.y/50)+(hero.hold?30:10))),hero.stand_on_cube=0,hero.vy>=0&&(obstacle1=hit(tl[0]+5,tl[1]-5),obstacle2=hit(tr[0]-5,tr[1]-5),obstacle3=hit(ml[0]+5,ml[1]-5),obstacle4=hit(mr[0]-5,mr[1]-5),1==obstacle3||1==obstacle4?(hero.grounded=1,hero.y=hity+(hero.hold?25:20),hero.vy=0):1==obstacle1||1==obstacle2?(hero.grounded=1,hero.y=hity+(hero.hold?20:12),hero.vy=0):2!=obstacle1&&2!=obstacle2||1==hit(bl[0]+5,bl[1]+15)||1==hit(br[0]+5,br[1]+15)?(hero.grounded=0,hero.vy+=gravity,hero.vy=Math.min(hero.vy,25),hero.y-=hero.vy):(hero.stand_on_cube=1,hero.grounded=1,hero.vy=0)),hero.walking=0,l&&(hero.x>10&&1!=hit(...tl)&&1!=hit(...ml)&&1!=hit(bl[0],bl[1]-10)&&(hero.x-=5),hero.mirror_h=1,hero.walk++,hero.walking=1),r&&(hero.x<790&&1!=hit(...tr)&&1!=hit(...mr)&&1!=hit(br[0],br[1]-10)&&(hero.x+=5),hero.mirror_h=0,hero.walk++,hero.walking=1),u||(u_release=1),u&&hero.grounded&&u_release&&(hero.vy-=hero.mirror_h?14:13,hero.y+=14,hero.grounded=0,u_release=0,hero.walking=0,hero.stand_on_cube=0),s||(s_release=1),s&&s_release){if(s_release=0,hero.hold)hero.mirror_h?cubes[hero.hold].x-=1==hit(cubes[hero.hold].x-40,cubes[hero.hold].y-25)||1==hit(cubes[hero.hold].x-40,cubes[hero.hold].y+25)?-5:15:cubes[hero.hold].x+=1==hit(cubes[hero.hold].x+40,cubes[hero.hold].y-25)||1==hit(cubes[hero.hold].x+40,cubes[hero.hold].y+25)?-5:15,cubes[hero.hold].holding=0,hero.hold=0;else for(e in cubes)if(!cubes[e].holding&&Math.abs(hero.x-cubes[e].x)<50&&Math.abs(hero.y-cubes[e].y)<80&&(Math.abs(hero.y-cubes[e].y)>40||(hero.mirror_h?hero.x>cubes[e].x-25:hero.x<cubes[e].x+25))){hero.y>cubes[e].y+25&&(obstacle1=hit(tl[0]-40,tl[1]),obstacle2=hit(ml[0]-40,ml[1]),1!=obstacle1&&1!=obstacle2||(hero.x=hitx+80),obstacle1=hit(tr[0]+40,tr[1]),obstacle2=hit(mr[0]+40,mr[1]),1!=obstacle1&&1!=obstacle2||(hero.x=hitx-80)),hero.stand_on_cube=0,hero.hold=+e,cubes[e].holding=current_self,cubes[e].last_grab=current_self;break}hold_timer=10}hero.hold&&(time_array[present_abs].cubes[hero.hold].x=cubes[hero.hold].x=hero.x+(canextendhitbox?hero.mirror_h?-25:25:0),time_array[present_abs].cubes[hero.hold].y=cubes[hero.hold].y=hero.y+25)}},interval=0,timeouts=[],levels=[["0000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000$00000000001100000000000001100000000000001120000000000001122000111111011111111111111101111111111111",["LET ME GUESS...<br>I CAN MOVE WITH WASD KEYS?","DUDE, I'M THE DEVIL, NOT A MONSTER!<br>YOU CAN USE THE ARROW KEYS TOO...",""],()=>{setTimeout((()=>{0==current_level&&(force_exit_open=1)}),6e3)},0,1e3],["000000000000000000000000000000000000000000000000000000000000000000020202000000000$006000000000000000000000000000000000000100000000000000011000000005000001110500111111111111011111111111111101110",["","PRESS SPACE<br>TO GRAB AND DROP BOXES","ARE WE IN AN AMAZON WAREHOUSE?","EW, NO!","","ACTIVATE ALL THE CUBE SLOTS<br>TO OPEN THE EXIT",""],()=>{},0,-2e3],["00111111001111100011111100111110000000030005000300000000000000000000000000000000000000000000000000000000000000000$000000000000000000000000000000000300002000300611110011111110001111001111111000",["","<br><br><br>THIS PLACE IS BEYOND LAWS OF PHYSICS,<br>SUCH AS GRAVITY...",""],()=>{},0,-2e3],["00010000111111110005000011113111000000$011100111000000000000000000000000000000000000000000000000000000003000000000000020000000000000002000000060111001111000000011131111100050001111111110001000",["","<br><br><br>YOU CAN DROP CUBES<br>ON THE GRAVITY INVERTERS",""],()=>{},0,0],["00000001110000000000000030000000000000000000000000000000000000000000000000000000000000005000000000000000000000000$000000000000000006020000000000000002003000000011111111110000001111111111000000",["","<br><br>PRESS R TO RESET.","<br>YOU MEAN, IF I MESS UP<br>SO BADLY THAT I GET STUCK?","<br><br>EXACTLY.",""],()=>{},0,-2e3],["11110000011111110$000000080000060000000008000000110000000800300011000000000110011100000000011551110011110001111111000880000111111100088000111111110000000111111111111111111111111111111111111111",["","<br><br><br><br><br><br><br><br><br><br><br>YOU CAN RECOGNIZE REVERSED CUBES<br>BY THE HEART DRAWN ON THEM...","<br><br>AND BY THE FACT THAT<br>THEY FALL UPWARDS, NO?","<br><br><br><br><br><br><br><br><br><br><br><p>YES, THAT TOO.",""],()=>{},0,-2e3],["0000000000000001000000000000000100000000000000010000000000000041000000000000111100000000000111110$0060000011111100000000011111110000000011111111000000011111111100209011111111111111111111111111",["","HERE, AT THE BRINK OF DEATH,<br>YOU CAN SEE YOUR LIFE FLASH<br>BEFORE YOUR EYES.",""],()=>{},0,-2e3],["00000000000000000000000000000000000000000000000000000000000000000000000$000000000000000000000000000000600000000002000000000000401110000000000111111100500900111111111111111111111111111111111111",["","REMEMBER, ALL SLOTS NEED TO BE<br>ACTIVATED SIMULTANEOUSLY!","BUT I ONLY HAVE ONE CUBE!",""],()=>{},0,-2e3],["11111111111111111111111111111111181111111111113110011111111110011000111111110001100001111110000110000000000000011$000040040006011000000000000001100001111110000119001111111100311111111111111111"],["11130030030031111900000000000041100000000000000160000000000000000000000000000000000000000000000000000000000000000000000000000000$000000000000000120000000000000115000000000000011110303003030111"],["00111000000111000190310000123010010001300310001000000000000000000000011100000000000010000000000000001$600000000000001000000001110100011110000010014000000000001000100000000031000001111111111000"],["1111111111111111000000005090030000000000000000000000000000000000000000000000000000000000000000000220$0000000400002200000000000001111100000000000111110000000006011111050300090001111111111111111",,()=>{},0,-2e3],["22222222222222222222222222222222220000000000002222111111111111222210000000000122001$000000060100001000000000010088102050504001888811111111111188880000000000008888888888888888888888888888888888",["<br><br><br><center>WHAT?!",""],()=>{}],["11110000000000111110000000000001110000011111000$10000011111110000000011100011100000011100000111120000000000001111100000002000000111000000000000011110000111000001111100111110000111111111111111100000000000000000000000000000000000000000000000006",["","CONGRATS, YOU MAY NOW GO TO HELL.","WAIT! IN THE INTRO<br>YOU SAID I COULD<br>CHOOSE MY PATH!","I LIED. MUAHAHAHAHA!",""],()=>{},0,-2e3],["111100000000001111100000000000011100000111110006100000111111100000000111000111000000111000001111200000000000011111000000020$00001110000000000000111100001110000011111001111100001111111111111111"],["2222222222222222220000000000002222111111111111222216000000000122221000000000012200100000000$0100001000000000010088102050504001888811111111111188880000000000008888888888888888888888888888888888"],["11111111111111110000000050900300000000008070000000000000000000000000000000000000000000000000000000006000000040000000000000000000111110000000000011111020000070$011111050300090001111111111111111",[],()=>{setTimeout((()=>{cubes[2].mirror_v=1}),16)}],["001110600001110001903100031230100100013000100010000000000000000000000111000000000000100000000000000010$00000000000001000000001110100011110000010014000000000001000100000000031000001111111111000"],["1110303003030111150000000000000118000000000000010000000000000000600000000000000000000000000000001111111111111110$0000000000000000000000000000000170000000000000119000000000000411113003003003111"],["11111111111111111111111111111111181111111111113110011111111110011000111111110001100001111110000110000000000000011600004004000$011000000000000001100001111110000119001111111100311111111111111111"],["000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000$00000000000000000000000401110002007000111111100500900111111111111111111111111111111111111"],["0000000006000001000000000000000100000000000000010000000000000041000000000000111100000000000111110000$0000011111100000000011111110000000011111111000000011111111100209011111111111111111111111111"],["1111000001111111060000000880000$0000000008000000110000000800300011000000000112211100000000011551110011110001111111000000000111111100000000111111110000000111111111111111111111111111111111111111",[]],["00000001110000000000000030000000000600000000000000000000000000000000000020000000000000005000000000000000800000000000000000000000000$000000000000000000003000000011111111110000001111111111000000"],["0001000011111111000500001111311100000000111001110000600000000000000000000000000000000000000000$0000000000000000000000000000080000000000000008000111001111000800011101111100030001111111110001000"],["001111110011111000111111001111100300000300050003000000000008000000000000000000000000000000000000000000000000000$06000000000000000000000000000000000300000000300311110011111110011111001111111001"],["000000000000000000000000000000000000000000000000000000000000000000020260000000000$00000000000000000000000000000000000000010000000000000001100200000500000111050011111111111101111111111111110111"],["000000000000000000000000000000000000000000000000000000000000000000000000000000$00000000000000000060000000000100000000000000110000000000000112000000000000112200011111101111111111111110111111111"],["00000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000011100000000000001111000000000000111110000000000011111100000000$011111111111111111111111111111111"]];</script>